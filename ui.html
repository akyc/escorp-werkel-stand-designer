<style>
  #loader {
    text-align: center;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, .4);
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
</style>

<p>Выделите необходимые механизмы и рамки для просчета и&nbsp;нажмите кнопку «Посчетать»</p>
<button id="copy">Посчетать</button>
<div id="result" style="margin-top: 20px;"></div>
<div id="loader">
  <p>Загрузка</p>
</div>
<script>
  document.getElementById('copy').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'copy' } }, '*')
  }
  let dbFile = document.createElement('script');
  dbFile.src = 'https://eurosvet.info/app/js/db.js';
  dbFile.charset = 'utf-8';
  document.body.appendChild(dbFile);
  dbFile.onload = function () {
    document.querySelector('#loader').remove()
  }

  function showResult(result) {
    let resultTabel = document.createElement('table')
    resultTabel.border = 1;
    resultTabel.innerHTML = `<tr><td>Наименование</td><td>Код</td><td>Количество</td> <td>Стоимость</td></tr>`
    for (let product in result) {
      let row = document.createElement('tr'),
        codeCol = document.createElement('td'),
        countCol = document.createElement('td'),
        nameCol = document.createElement('td'),
        priceCol = document.createElement('td');
      nameCol.textContent = db['products'][product]['n']
      codeCol.textContent = product;
      countCol.textContent = result[product];
      priceCol.textContent = db['products'][product]['p']['1'] * result[product] + ' ₽'
      row.appendChild(nameCol)
      row.appendChild(codeCol)
      row.appendChild(countCol)
      row.appendChild(priceCol)
      resultTabel.appendChild(row)
    }
    document.querySelector('#result').innerHTML = "";
    document.querySelector('#result').appendChild(resultTabel);
  }
  window.onmessage = event => {
    const message = event.data.pluginMessage;
    if (message.type === 'ok') {
      if (message.value) {
        showResult(message.value)
      } else {
        document.querySelector('#result').innerHTML = "Нет выделенных элементов";
      }
    }
  };
</script>